<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<title>AttendanceTracker</title>
</head>

<body>
	<div id="attendance-table"></div>
	<button class="btn" onclick="copyAttendanceData()">Copy!</button>
	<script>
		// Get current date and time
		const today = new Date();
		const date = `${today.getDate()}.${today.getMonth() + 1}.${today.getFullYear()}`;

		// Fill in class and teacher information
		const classAndSection = 'XII J';
		let time = '';
		let teacher = '';
		let subject = '';
		let topic = '';

		// Initialize attendance counts
		let total = 40;
		let present = 0;
		let absent = 0;
		let absentees = [];

		// Add event listeners to attendance cells
		const attendanceTable = document.getElementById('attendance-table');
		attendanceTable.addEventListener('click', (event) => {
			if (event.target.matches('.attendance-cell')) {
				if (event.target.textContent === 'Absent') {
					event.target.textContent = 'Present';
					present++;
					absent--;
					const index = absentees.indexOf(event.target.parentNode.firstChild.textContent);
					if (index > -1) {
						absentees.splice(index, 1);
					}
				} else {
					event.target.textContent = 'Absent';
					present--;
					absent++;
					absentees.push(event.target.parentNode.firstChild.textContent);
				}
				updateAttendanceSummary();
			}
		});

		function updateClassDetails() {
			const newTeacher = prompt('Enter teacher name:');
			const newSubject = prompt('Enter subject:');
			const newTopic = prompt('Enter topic:');
			const newTime = prompt('Enter time:')
			if (newTeacher !== null) {
				teacher = newTeacher;
			}
			if (newSubject !== null) {
				subject = newSubject;
			}
			if (newTopic !== null) {
				topic = newTopic;
			}
			if (newTime !== null) {
				time = newTime;
			}
			updateAttendanceSummary();
		}

		// Update attendance summary
		function updateAttendanceSummary() {
			total = present + absent;
			const attendanceSummary = `Date: ${date}\nTime: ${time}\nClass and section: ${classAndSection}\nTeacher: ${teacher}\nSubject: ${subject}\nTopic: ${topic}\nTotal: ${total}\nPresent: ${present}\nAbsent: ${absent}\n\nNames of absentees:\n${absentees.join('\n')}`;
			const attendanceDisplay = document.getElementById('attendance-display')
			console.log(attendanceSummary);
		}

		// Export attendance data to CSV file
		function exportAttendanceData() {
			const rows = attendanceTable.querySelectorAll('tr');
			let csv = 'Name,Present/Absent\n';
			for (let i = 1; i < rows.length; i++) {
				const name = rows[i].firstChild.textContent;
				const attendance = rows[i].querySelector('.attendance-cell').textContent;
				csv += `${name},${attendance}\n`;
			}
			const csvBlob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
			const url = URL.createObjectURL(csvBlob);
			const downloadLink = document.createElement('a');
			downloadLink.href = url;
			downloadLink.download = `attendance-${date}.csv`;
			downloadLink.click();
		}

		async function copyAttendanceData() {
			await updateClassDetails();
			total = present + absent;
			const attendanceSummary = `Date: ${date}\nTime: ${time}\nClass and section: ${classAndSection}\nTeacher: ${teacher}\nSubject: ${subject}\nTopic: ${topic}\nTotal: ${total}\nPresent: ${present}\nAbsent: ${absent}\n\nNames of absentees:\n${absentees.join('\n')}`;
			try {
				await navigator.clipboard.writeText(attendanceSummary);
				alert('Copied to clipboard!')
			} catch (err) {
				console.error('Failed to copy: ', err);
			}
		}

		// Initialize attendance table
		function initializeAttendanceTable() {
			const attendanceTable = document.getElementById('attendance-table');
			const names = ['Abhinaba Chowdhury', 'Abhinanda Chowdhury', 'Aditya Bothra', 'Ambarish Basu', 'Archisman Das', 'Aric Maji', 'Arin Biswas', 'Aritra Roy', 'Arkaprobho Sinha Roy', 'Aryan Mukherjee', 'Ayush Bhakta', 'Ayushmaan Chakravarty Bhattacharya', 'Dhanish Shah', 'Dibyadipan Bhattacharya', 'Hiya Samanta', 'Kairav Nandi', 'Lolit Bairiganjan', 'Muhammad Raza Khan', 'Naireet Sadhu Khan', 'Partha Sarathi Malakar', 'Priyangshu Chakraborty', 'Pubali Dutta', 'Rajnandini Sen', 'Riddhi Shukla', 'Sagnik Mukherjee', 'Satyam Singh', 'Saunak Chanda', 'Sayan Das Dey', 'Shiven Thakker', 'Sneha Paul', 'Snehal Rakshit', 'Soham Ghosh', 'Soumyadeep Mukherjee', 'Sreeparni Bhowmik', 'Srijita Roychowdhury', 'Suchitrak Bandyopadhyay', 'Supratik Biswas', 'Trisha Chatterjee', 'Ved Chattopadhyay', 'Vritaant Bajaj', 'Zinnia Bag'];
			for (let i = 0; i < names.length; i++) {
				const row = document.createElement('tr');
				const nameCell = document.createElement('td');
				nameCell.textContent = names[i];
				row.appendChild(nameCell);
				const attendanceCell = document.createElement('td');
				attendanceCell.classList.add('attendance-cell');
				attendanceCell.textContent = 'Absent';
				row.appendChild(attendanceCell);
				attendanceTable.appendChild(row);
				absentees.push(names[i])
				absent++;
			}
			// updateClassDetails();
			updateAttendanceSummary();
		}
		// Call the initializeAttendanceTable function to set up the table
		initializeAttendanceTable();
	</script>
</body>

</html>